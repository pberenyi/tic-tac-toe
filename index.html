<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tic Tac Toe Extended</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      margin: 0;
      background: #acacac;
    }
    h1 { margin: 5px; font-size: 1.5em; }
    #controls {
      margin: 10px;
    }
    .cell {
      background: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      user-select: none;
      aspect-ratio: 1 / 1;
      min-width: 0;
      min-height: 0;
      overflow: hidden;
    }
    .winner-cell {
      color: red !important;
      font-weight: bold;
    }
    :root {
      --cell-font-size: 2em;
    }
    
    #board {
      display: grid;
      gap: 2px;
      background: #222;
      margin-top: 15px;
    }
    
    .cell {
      font-size: var(--cell-font-size);
    }

    #overlay {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255, 255, 255, 0.95);
      border: 2px solid #333;
      padding: 20px 40px;
      border-radius: 10px;
      font-size: 1.5em;
      font-weight: bold;
      text-align: center;
      z-index: 999;
      box-shadow: 0px 4px 15px rgba(0,0,0,0.3);
      pointer-events: none; /* disable interactions when hidden */
    }

    #overlay.show {
      display: block;
      pointer-events: auto;
    }
  </style>
</head>
<body>
  <h1>Tic Tac Toe Extended</h1>
  <div id="message"></div>
  <div id="controls">
    <label>Board size:
      <input id="boardSize" type="number" min="3" max="20" value="3">
    </label>
    <label>Win length:
      <input id="winLength" type="number" min="3" max="10" value="3">
    </label>
    <label>Start as: 
      <select id="startMarker">
        <option value="X">X</option>
        <option value="O">O</option>
      </select>
    </label>
    <button id="startBtn">Start Game</button>
  </div>

  <div id="board"></div>
  <div id="overlay"></div>
  
  <script>
    const boardDiv = document.getElementById("board");
    const message = document.getElementById("message");
    const boardSizeInput = document.getElementById("boardSize");
    const winLengthInput = document.getElementById("winLength");

    let boardSize = 3;
    let winLength = 3;
    let currentPlayer = "X";
    let boardState = [];

    function updateWinLengthInput() { // win length contraints
      boardSize = parseInt(boardSizeInput.value);
      let minWin, maxWin;
      if (boardSize === 3) {
        minWin = maxWin = 3;
      } else if (boardSize < 6) {
        minWin = 4;
        maxWin = boardSize;
      } else {
        minWin = 4;
        maxWin = boardSize;
      }
      winLengthInput.min = minWin;
      winLengthInput.max = maxWin;
      if (parseInt(winLengthInput.value) < minWin || parseInt(winLengthInput.value) > maxWin) {
        winLengthInput.value = minWin;
      }
    }

    boardSizeInput.addEventListener("change", updateWinLengthInput);

    function createBoard() {
      hideOverlay();
      boardDiv.innerHTML = '';

      const maxBoardWidth = Math.min(window.innerWidth, window.innerHeight) * 0.9;
      const minCellSize = 20; // minimum cell size in pixels
      const boardWidth = Math.max(boardSize * minCellSize, maxBoardWidth);
      const cellSize = boardWidth / boardSize;
      const fontSize = Math.max(0.5, Math.min(2, cellSize / 20));
      
      boardDiv.style.gridTemplateColumns = `repeat(${boardSize}, 1fr)`;
      boardDiv.style.width = boardWidth + "px";
      boardDiv.style.height = boardWidth + "px";
      currentPlayer = document.getElementById("startMarker").value;
      
      document.documentElement.style.setProperty('--cell-font-size', fontSize + 'em');

      boardState = Array.from({ length: boardSize }, () => Array(boardSize).fill(""));

      for (let r = 0; r < boardSize; r++) {
        for (let c = 0; c < boardSize; c++) {
          const cell = document.createElement("div");
          cell.classList.add("cell");
          cell.dataset.row = r;
          cell.dataset.col = c;
          cell.onclick = handleMove;
          boardDiv.appendChild(cell);
        }
      }
      message.textContent = `Player ${currentPlayer}'s turn (need ${winLength} in a row)`;
    }

    function handleMove(e) {
      const r = parseInt(e.target.dataset.row);
      const c = parseInt(e.target.dataset.col);

      if (boardState[r][c] !== "") return;

      boardState[r][c] = currentPlayer;
      e.target.textContent = currentPlayer;

      let winningCells = checkWin(r, c);
      if (winningCells) {
        highlightWinningCells(winningCells);
        showOverlay(`ðŸŽ‰ Player ${currentPlayer} wins!`);
        disableBoard();
        return;
      }

      if (isDraw()) {
        showOverlay("It's a draw!");
        disableBoard();
        return;
      }

      currentPlayer = currentPlayer === "X" ? "O" : "X";
      message.textContent = `Player ${currentPlayer}'s turn`;
    }

    function checkWin(row, col) {
      const directions = [
        [1, 0],  // horizontal
        [0, 1],  // vertical
        [1, 1],  // diagonal
        [1, -1], // anti-diagonal
      ];

      for (let [dr, dc] of directions) {
        let cells = getLine(row, col, dr, dc);
        if (cells.length >= winLength) {
          return cells;
        }
      }
      return null;
    }

    function getLine(r, c, dr, dc) {
      let cells = [];
      let i = r, j = c;
      // back
      while (
        i >= 0 && i < boardSize &&
        j >= 0 && j < boardSize &&
        boardState[i][j] === currentPlayer
      ) {
        cells.push([i, j]);
        i -= dr;
        j -= dc;
      }
      // forward
      i = r + dr;
      j = c + dc;
      while (
        i >= 0 && i < boardSize &&
        j >= 0 && j < boardSize &&
        boardState[i][j] === currentPlayer
      ) {
        cells.push([i, j]);
        i += dr;
        j += dc;
      }
      return cells.length >= winLength ? cells : [];
    }

    function highlightWinningCells(cells) {
      cells.forEach(([r, c]) => {
        let cell = document.querySelector(`.cell[data-row="${r}"][data-col="${c}"]`);
        if (cell) {
          cell.classList.add("winner-cell");
        }
      });
    }

    function isDraw() {
      return boardState.flat().every(cell => cell !== "");
    }

    function disableBoard() {
      [...document.querySelectorAll(".cell")].forEach(cell => cell.onclick = null);
    }

    function showOverlay(text) {
      let overlay = document.getElementById("overlay");
      overlay.innerHTML = text + '<br><br><button onclick="hideOverlay(); createBoard();">OK</button>';
      overlay.classList.add("show");
    }

    function hideOverlay() {
      let overlay = document.getElementById("overlay");
      overlay.classList.remove("show");
    }

    function validateInput(size, length) {
      if (size === 3 && length !== 3) {
        showOverlay("3Ã—3 board only allows 3 in a row.");
        return 3;
      }
      if (size > 3 && length < 4) {
        showOverlay(size + "Ã—" + size + " board can only play 4 or more in a row.");
        return 4;
      }
      if (length === 5 && size < 6) {
        showOverlay("For 5 in a row, the board must be at least 6Ã—6.");
        return 5;
      }
      if (length > size) {
        showOverlay("Win length cannot be greater than board size!");
        return size;
      }
      return length;
    }

    document.getElementById("startBtn").addEventListener("click", () => {
      boardSize = parseInt(boardSizeInput.value);
      winLength = parseInt(winLengthInput.value);
      
      const maxBoardWidth = Math.min(window.innerWidth, window.innerHeight) * 0.9;
      const minCellSize = 20;
      const maxPossibleSize = Math.floor(maxBoardWidth / minCellSize);
      
      if (boardSize > maxPossibleSize) {
        showOverlay(`Board size reduced to ${maxPossibleSize} to fit on screen with minimum cell size.`);
        boardSize = maxPossibleSize;
        boardSizeInput.value = boardSize;
        return;
      }
      
      const validatedLength = validateInput(boardSize, winLength);
      if (validatedLength !== winLength) {
        winLength = validatedLength;
        winLengthInput.value = winLength;
        return;
      }
      
      currentPlayer = document.getElementById("startMarker").value;
      createBoard();
    });

    // Initialize
    updateWinLengthInput();
    createBoard();

    window.addEventListener("resize", () => {
      const maxBoardWidth = Math.min(window.innerWidth, window.innerHeight) * 0.9;
      const minCellSize = 20;
      const boardWidth = Math.max(boardSize * minCellSize, maxBoardWidth);
      const cellSize = boardWidth / boardSize;
      const fontSize = Math.max(0.5, Math.min(2, cellSize / 20));
      
      boardDiv.style.width = boardWidth + "px";
      boardDiv.style.height = boardWidth + "px";
      document.documentElement.style.setProperty('--cell-font-size', fontSize + 'em');
    });
  </script>
</body>
</html>
